# .github/workflows/validate-ptag-core.yml
name: Validate P-Tag (core reusable)

# CI PHASES A-B-C-D:
# - Assemble: Install dependencies, verify environment setup
# - Baseline: Core validation (types exist, lint passes, tests pass)
# - Coverage: Generate coverage / testing reports
# - Deploy: Build package and docs (sanity checks for release readiness)

on:
  workflow_call:

permissions:
  contents: read

jobs:
  validate-ptag-core:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: A1) Checkout
        uses: actions/checkout@v5

      - name: A2) Set up Node.js
        uses: actions/setup-node@v6
        with:
          node-version: "20"

      - name: A3) Install ajv-cli
        run: npm install -g ajv-cli

      - name: B1) Validate provenance/ptag.json against core schema
        shell: bash
        run: |
          if [ ! -f "provenance/ptag.json" ]; then
            echo "No provenance/ptag.json found. Skipping."
            exit 0
          fi

          SCHEMA_URL="https://raw.githubusercontent.com/civic-interconnect/civic-ptag-core-schema/main/schema/ptag.core.schema.json"
          echo "Using schema: ${SCHEMA_URL}"
          ajv -s "${SCHEMA_URL}" -d "provenance/ptag.json"
